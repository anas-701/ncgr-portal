<!-- <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <app-shared-dynamic-form [form]="form" [fields]="formFields" [parentStyleClass]="'row'"/> 
    <div class="d-flex gap-4 justify-content-end mt-4">
        <button type="submit" class="btn btn-primary">
            حفظ
        </button>
    </div>
</form> -->

<section class="create_program mt-4 mb-4">
    <div class="container">
        <div class="d-flex gap-4">
            <div class="dashboard_link_sec">
                <app-side-bar></app-side-bar>
            </div>
            <div class="flex-grow-1">
                <div class="row">
                    <div class="add-training-container">
                        <div class="mb-4">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">الرئيسية</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        {{_router.url.includes('create')?'إنشاء  قالب':'تعديل  قالب'}}

                                    </li>
                                </ol>
                            </nav>
                            <h1>{{_router.url.includes('create')?'إنشاء قالب ':'تعديل  قالب'}} </h1>
                        </div>
                        <form [formGroup]="form" (ngSubmit)="onSubmit()">
                            <app-shared-dynamic-form [form]="form" [fields]="formFields" [parentStyleClass]="'row'" />
                            <div class="d-flex gap-4 justify-content-end mt-4">
                                <button type="submit" class="btn btn-primary">
                                    حفظ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-3">

            <!-- certificate-editor.component.html -->
            <!-- src/app/certificate-editor/certificate-editor.component.html -->

            <div class="row">
                <div class="col-md-4">
                    <div class="card p-3 shadow-sm">
                        <h5 class="mb-3 text-end">إعدادات القالب</h5>

                        <div class="mb-3">
                            <label for="certificateBg" class="form-label">خلفية الشهادة</label>
                            <input type="file" class="form-control" (change)="onBackgroundUpload($event)"
                                id="certificateBg" accept="image/*" />
                        </div>

                        <div class="mb-3">
                            <label for="signatureImage" class="form-label">صورة التوقيع</label>
                            <input type="file" class="form-control" (change)="onSignatureUpload($event)"
                                id="signatureImage" accept="image/*" />
                        </div>

                        <div class="mt-4">
                            <h6 class="text-end">العناصر</h6>
                            <div class="list-group">
                                <div *ngFor="let element of certificateData.templateSettings.elements"
                                    class="list-group-item draggable" draggable="true"
                                    (dragstart)="onDragStart($event, element)">
                                    {{element.label}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-md-8">
                    <div class="card shadow-sm p-3 text-center">
                        <h5 class="text-end mb-3">معاينة القالب</h5>
                        <div class="certificate-preview position-relative" (drop)="onDrop($event)"
                            (dragover)="onDragOver($event)"
                            style="height: 800px; background-size: contain; background-repeat: no-repeat;"
                            [style.background-image]="'url(' + (certificateBackground || 'assets/default-certificate.png') + ')'">

                            <div *ngFor="let element of certificateData.templateSettings.elements"
                                class="position-absolute draggable-element" [style.left.px]="element.position.x"
                                [style.top.px]="element.position.y" [style.fontSize.px]="element.fontSize"
                                [style.color]="element.fontColor"
                                [style.display]="draggedElements.has(element.id) || element.value ? 'block' : 'none'"
                                draggable="true" (dragstart)="onDragStart($event, element)">

                                <span *ngIf="element.type === 'text' || element.type === 'date'">{{element.value ||
                                    element.label}}</span>
                                <img *ngIf="element.type === 'image' && element.value" [src]="element.value"
                                    [style.width.px]="element.width" [style.height.px]="element.height" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="row mt-3">
                <div class="col-12 text-end">
                    <button class="btn btn-primary" (click)="saveCertificate()">حفظ الشهادة</button>
                </div>
            </div>

        </div>
    </div>
</section>